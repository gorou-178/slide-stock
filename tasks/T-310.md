# セッション管理セキュア化

docs/security-plan.md の方針に従い、セッション管理をセキュア化してください。

## 前提

- T-300 で定義された docs/security-plan.md を参照する
- 既存テストが全てパスする状態を維持する

## やること

1. docs/security-plan.md のセッション管理方針を確認する

2. セッション Cookie のセキュア化:
   - HttpOnly 属性を付与する
   - Secure 属性を付与する（本番環境）
   - SameSite=Lax を設定する
   - 適切な有効期限を設定する（例: 7日間）
   - Cookie の Path を `/api` に限定する

3. セッション発行・検証ロジックの改善:
   - セッショントークンの生成（crypto.randomUUID 等）
   - D1 にセッションテーブルを追加する（必要な場合）
   - セッション検証ミドルウェアの実装

4. テスト互換性:
   - TEST_MODE=true の場合は既存の test-auth-bypass を維持する
   - 本番モードでのみセキュアセッションを使用する

5. `npm test` で全テストがパスすることを確認する
