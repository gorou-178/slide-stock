# 本番用認証ミドルウェア実装

セッション Cookie を検証し、AuthContext を注入する認証ミドルウェアを実装してください。

## 前提

- docs/auth-spec.md（T-500 で作成）の仕様に従う
- T-501 で実装されたセッション発行ロジックと整合させる
- 既存の worker/middleware/test-auth-bypass.ts を参考にする
- TEST_MODE=true の場合は既存の test-auth-bypass を維持する

## やること

1. worker/middleware/auth.ts を作成する:
   - リクエストからセッション Cookie を取得する
   - セッションを検証する（署名検証 or D1 セッションテーブル参照）
   - 検証成功時: AuthContext（userId, email, name）を返す
   - 検証失敗時: 401 Unauthorized を返す

2. worker/index.ts のルーティングを更新する:
   - TEST_MODE=true: 既存の test-auth-bypass を使用
   - TEST_MODE=false: 新しい auth ミドルウェアを使用
   - /api/auth/* は認証不要（ログイン・ログアウト用）

3. `npm test` で全テストがパスすることを確認する

4. 変更をコミットする
