# Stock API仕様策定

Stock CRUD API（POST/GET/GET:id/DELETE）の詳細仕様を定義してください。

## 前提

- CLAUDE.md のAPI設計（セクション6）を参照する
- docs/database.md の stocks テーブルを参照する
- docs/architecture.md のリクエストフローを参照する

## やること

1. CLAUDE.md と docs/ を読み、Stock API の要件を把握する

2. docs/stock-api-spec.md を作成し、以下を定義する:

   ### POST /api/stocks
   - リクエストボディ: `{ url: string }`
   - レスポンス: 201 Created + stock オブジェクト
   - バリデーション: URL 形式、対応プロバイダ
   - 重複チェック: 同一ユーザー × canonical_url で重複時のレスポンス（409 or 既存返却）

   ### GET /api/stocks
   - クエリパラメータ: ページネーション（cursor / offset、limit）
   - レスポンス: stock 配列 + ページネーション情報
   - ソート: created_at DESC
   - メモ結合: memo_text を含めるか（LEFT JOIN）

   ### GET /api/stocks/:id
   - レスポンス: stock オブジェクト（メモ付き）
   - 所有権チェック: 他ユーザーの stock は 404

   ### DELETE /api/stocks/:id
   - レスポンス: 204 No Content
   - 関連メモの削除方針（CASCADE or 手動）

   ### 共通
   - エラーレスポンス形式: `{ error: string, code?: string }`
   - 認証必須（401 Unauthorized）

3. QA/DEV タスク（T-531〜T-536）が実行可能になるよう、仕様を具体的に記述する
