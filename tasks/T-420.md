# production merge後deploy workflow追加

main ブランチへのマージ後に自動デプロイする GitHub Actions workflow を作成してください。

## 前提

- T-120 の CI workflow が存在すること
- T-400 の docs/production-plan.md を参照する

## やること

1. `.github/workflows/deploy.yml` を作成する（または ci.yml に追加）

2. トリガー:
   - `push` → `main` ブランチ（マージ完了時）

3. デプロイステップ:
   - Node.js セットアップ (v20)
   - `npm ci` で依存インストール
   - `npm run build` で Astro ビルド
   - D1 マイグレーション実行（`wrangler d1 migrations apply`）
   - Workers デプロイ（`wrangler deploy worker/index.ts`）
   - Pages デプロイ（`wrangler pages deploy dist/`）

4. Secrets 設定:
   - `CLOUDFLARE_API_TOKEN` を GitHub Actions secrets に設定する前提で記述
   - `CLOUDFLARE_ACCOUNT_ID` も同様

5. 注意事項:
   - デプロイ順序: DB マイグレーション → Workers → Pages
   - デプロイ失敗時の通知（GitHub Actions の失敗通知で十分）
