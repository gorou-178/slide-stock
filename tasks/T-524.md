# oEmbed/Queueのユニットテスト

oEmbed フェッチサービスと Queue コンシューマーの自動テストを作成してください。

## 前提

- docs/oembed-spec.md の仕様に基づいてテストを設計する
- テスト対象: worker/lib/oembed.ts, worker/index.ts の queue() ハンドラ
- HTTP リクエストは mock する

## やること

1. test/worker/oembed.test.ts を作成する:
   - SpeakerDeck の oEmbed 取得（mock HTTP レスポンス）
   - Docswell の oEmbed 取得（mock HTTP レスポンス）
   - Google Slides の embed URL 構築
   - HTTP エラー時のエラーハンドリング
   - タイムアウト時のエラーハンドリング
   - 不正な JSON レスポンス時のエラーハンドリング

2. test/worker/queue-consumer.test.ts を作成する:
   - 正常系: メッセージ受信 → oEmbed 取得成功 → stock を 'ready' に更新
   - 異常系: oEmbed 取得失敗 → stock を 'failed' に更新
   - message.ack() が呼ばれることを確認

3. テストが正しく「失敗する」ことを確認する（実装前の場合）

4. テストコードをコミットする
