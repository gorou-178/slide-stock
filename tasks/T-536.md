# Stock APIユニットテスト

Stock CRUD API の自動テストを作成してください。

## 前提

- docs/stock-api-spec.md の仕様に基づいてテストを設計する
- テスト対象: POST/GET/GET:id/DELETE /api/stocks
- テストヘルパー: test/helpers/（workerFetch, applyMigrationsAndSeed 等）
- src/test/seed.ts のテストデータを使用する

## やること

1. test/worker/stocks.test.ts を作成する:

   ### POST /api/stocks
   - 正常系: 有効な URL → 201 + stock オブジェクト
   - URL バリデーション: 無効な URL → 400
   - 未対応プロバイダ: → 400
   - 重複 URL: 同一ユーザー × 同一 canonical_url → 409 or 既存返却
   - 認証なし: → 401

   ### GET /api/stocks
   - 正常系: 認証ユーザーの stock 一覧 → 200
   - ソート: created_at DESC
   - メモ結合: memo_text が含まれる
   - 空一覧: stock なし → 200 + 空配列
   - ページネーション: limit, cursor/offset
   - 認証なし: → 401
   - ユーザー間分離: 他ユーザーの stock は含まれない

   ### GET /api/stocks/:id
   - 正常系: → 200 + stock オブジェクト
   - 存在しない ID: → 404
   - 他ユーザーの stock: → 404
   - 認証なし: → 401

   ### DELETE /api/stocks/:id
   - 正常系: → 204
   - 存在しない ID: → 404
   - 他ユーザーの stock: → 404
   - 関連メモも削除される

2. テストが正しく「失敗する」ことを確認する（実装前の場合）

3. テストコードをコミットする
