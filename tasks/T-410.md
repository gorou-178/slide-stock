# Production build設定整備

本番ビルドに必要な設定を整備してください。

## 前提

- T-400 の docs/production-plan.md を参照する

## やること

1. wrangler.toml の本番環境設定を追加する:
   - `[env.production]` セクション
   - 本番用 D1 データベースバインディング
   - 本番用の互換性フラグ

2. Astro のビルド設定を確認・調整する:
   - `astro.config.mjs` で Cloudflare Pages 向けの最適化
   - 環境変数の注入方法（PUBLIC_ prefix）

3. TypeScript ビルドの確認:
   - `npx tsc --noEmit` がエラーなしで通ること
   - `npm run build` が成功すること

4. 環境変数の切り替え:
   - ローカル開発: `.dev.vars` の `TEST_MODE=true`
   - 本番: `TEST_MODE` を設定しない（test-auth-bypass が無効になる）

5. ビルド成果物の確認:
   - `dist/` に静的ファイルが生成されること
   - Workers のビルドが成功すること
